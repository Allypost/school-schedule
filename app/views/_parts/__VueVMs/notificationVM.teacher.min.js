window.notificationVM=new Vue({el:"#notifications",data:{users:{},notifications:{},teaching:{},loading:0,isLoaded:!1},filters:{date:function(t){return moment.utc(t).format("DD/MM/YYYY")},time:function(t){return moment.utc(t).format("DD/MM/YYYY h:mm a")}},methods:{getUsersUrl:function(){return $(this.$el).attr("data-users")},fetchField:function(t,n){var i=this,e=t.split("").reduce(function(t,n){return t=(t<<5)-t+n.charCodeAt(0),t&t},0);return i.loading^=e,isFunction(n)||(n=new Function),$.get(t).done(function(t){var i=t.data;n(!0,i),$(".collapsible").collapsible()}).fail(function(t){var i=t.errors;n(!1,i)}).always(function(){i.loading^=e})},fetchUsers:function(t){var n=this,i=n.getUsersUrl();return n.fetchField(i,function(i,e){i&&n.setUsers(e),isFunction(t)||(t=new Function),t()})},setUsers:function(t){this.$set(this,"users",t)},getTeachingUrl:function(){return $(this.$el).attr("data-teaching")},fetchTeaching:function(t){var n=this,i=this.getTeachingUrl();return n.fetchField(i,function(i,e){i&&n.setTeaching(e),isFunction(t)||(t=new Function),t()})},setTeaching:function(t){var n={};for(var i in t)if(t.hasOwnProperty(i)){var e=t[i];e.unseen=0,n[e.id]=e}this.$set(this,"teaching",n)},getNotificationsUrl:function(){return $(this.$el).attr("data-notifications")},fetchNotifications:function(t){var n=this,i=this.getNotificationsUrl();return n.fetchField(i,function(i,e){i&&n.setNotifications(e),isFunction(t)||(t=new Function),t()})},setNotifications:function(t){var n={};for(var i in t)if(t.hasOwnProperty(i)){n[i]=t[i].reverse();for(var e in n[i])n[i].hasOwnProperty(e)&&(n[i][e].unseen=0)}this.$set(this,"notifications",n)},fetchData:function(t){var n=this;isFunction(t)||(t=new Function);var i=function(){return n.$nextTick(function(){0===n.loading&&(n.hydrateUnseen(),$(".collapsible").collapsible(),t())})};n.fetchUsers(i),n.fetchTeaching(i),n.fetchNotifications(i)},seen:function(t,n){var i=moment.utc(t.date),e=moment.utc(n.seen);return i.isBefore(e)},hydrateUnseen:function(){var t=this,n=t.notifications,i=t.teaching,e=t.users,r={};for(var s in n)if(n.hasOwnProperty(s)){r[s]=0;var o=n[s];for(var a in o)if(o.hasOwnProperty(a)){var c=e[s];if(c){var f=o[a];for(var u in c)if(c.hasOwnProperty(u)){var h=c[u],l=this.seen(f,h);f.unseen+=!l,r[s]+=!l,l||t.$set(f,"unseen",f.unseen)}}}}for(var d in r)t.$set(i[d],"unseen",r[d]);return r}},mounted:function(){var t=this;t.fetchData(),t.isLoaded=!0,setInterval(t.fetchData,12e4)}});